As atividades neste .txt s√£o do arquivo Desafio_aula04.docx



--1
SELECT SUB.BDCODEMP, SUB.BDCHAVE, SUB.BDREFLAN, SUB.BDCODPROD, SUB.BDBCICMS, SUB.BDALIQICMS, SUB.BDVLRICMS
FROM (
    SELECT ENT.BDCODEMP, PROD.BDCODPROD, ENT.BDCHAVE, PROD.BDBCICMS, PROD.BDALIQICMS, PROD.BDVLRICMS, ENT.BDCODTER, ENT.BDREFLAN
    FROM (
        SELECT ENT.*
        FROM VEF_EMP_TMOVENT ENT
        WHERE ENT.BDCODEMP = 67 AND ENT.BDREFLAN = 202101
         ) ENT
    JOIN VEF_EMP_TMOVENTITENS ITENS ON 
    (ITENS.BDCODEMP = ENT.BDCODEMP AND ITENS.BDCHAVE = ENT.BDCHAVE)
    JOIN VEF_EMP_TMOVPROENT PROD ON 
    (PROD.BDCODEMP = ITENS.BDCODEMP AND PROD.BDCHAVE = ITENS.BDCHAVE AND PROD.BDORDEM = ITENS.BDORDEM)

    UNION ALL

    SELECT SAI.BDCODEMP, PROD.BDCODPROD, SAI.BDCHAVE, PROD.BDBCICMS, PROD.BDALIQICMS, PROD.BDVLRICMS, SAI.BDCODTER, SAI.BDREFLAN
    FROM (
        SELECT SAI.*
        FROM VEF_EMP_TMOVSAI SAI
        WHERE SAI.BDCODEMP = 67 AND SAI.BDREFLAN = 202101
         ) SAI
    JOIN VEF_EMP_TMOVSAIITENS ITENS ON
    (ITENS.BDCODEMP = SAI.BDCODEMP AND ITENS.BDCHAVE = SAI.BDCHAVE)
    JOIN VEF_EMP_TMOVPROSAI PROD ON
    (PROD.BDCODEMP = ITENS.BDCODEMP AND PROD.BDCHAVE = ITENS.BDCHAVE AND PROD.BDORDEM = ITENS.BDORDEM)
     ) SUB
JOIN VW_TTERCEIRO TER ON
(TER.BDCODTER = SUB.BDCODTER)



--2
SELECT SUB.BDMOVIMENTO, SUB.BDCODEMP, SUB.BDCHAVE, SUB.BDREFLAN,
       CAST(SUM(SUB.BDBCICMS) * 0.20 AS NUMERIC(15, 2)) VALOR_CALCULADO
FROM (
    SELECT 'ENT' BDMOVIMENTO, ENT.BDCODEMP, PROD.BDCODPROD, ENT.BDCHAVE, PROD.BDBCICMS, PROD.BDALIQICMS, PROD.BDVLRICMS, ENT.BDCODTER, ENT.BDREFLAN
    FROM (
        SELECT ENT.*
        FROM VEF_EMP_TMOVENT ENT
        WHERE ENT.BDCODEMP = 67 AND ENT.BDREFLAN = 202101
         ) ENT
    JOIN VEF_EMP_TMOVENTITENS ITENS ON 
    (ITENS.BDCODEMP = ENT.BDCODEMP AND ITENS.BDCHAVE = ENT.BDCHAVE)
    JOIN VEF_EMP_TMOVPROENT PROD ON 
    (PROD.BDCODEMP = ITENS.BDCODEMP AND PROD.BDCHAVE = ITENS.BDCHAVE AND PROD.BDORDEM = ITENS.BDORDEM)

    UNION ALL

    SELECT 'SAI' BDMOVIMENTO, SAI.BDCODEMP, PROD.BDCODPROD, SAI.BDCHAVE, PROD.BDBCICMS, PROD.BDALIQICMS, PROD.BDVLRICMS, SAI.BDCODTER, SAI.BDREFLAN
    FROM (
        SELECT SAI.*
        FROM VEF_EMP_TMOVSAI SAI
        WHERE SAI.BDCODEMP = 67 AND SAI.BDREFLAN = 202101
         ) SAI
    JOIN VEF_EMP_TMOVSAIITENS ITENS ON
    (ITENS.BDCODEMP = SAI.BDCODEMP AND ITENS.BDCHAVE = SAI.BDCHAVE)
    JOIN VEF_EMP_TMOVPROSAI PROD ON
    (PROD.BDCODEMP = ITENS.BDCODEMP AND PROD.BDCHAVE = ITENS.BDCHAVE AND PROD.BDORDEM = ITENS.BDORDEM)
     ) SUB
JOIN VW_TTERCEIRO TER ON
(TER.BDCODTER = SUB.BDCODTER)
GROUP BY SUB.BDCODEMP, SUB.BDCHAVE, SUB.BDREFLAN, SUB.BDMOVIMENTO



--3
SELECT P.BDCODEMP, SUB.BDCHAVE, SUB.BDNUMDOCINI
FROM (
      SELECT M.BDCODEMP, M.BDCHAVE, M.BDNUMDOCINI
      FROM VEF_EMP_TMOVENT M
      WHERE M.BDCODEMP = 67 AND M.BDREFLAN = 202101
     ) SUB
LEFT OUTER JOIN VEF_EMP_TMOVENTITENS I ON (I.BDCODEMP = SUB.BDCODEMP AND I.BDCHAVE = SUB.BDCHAVE)
LEFT OUTER JOIN VEF_EMP_TMOVPROENT P ON (P.BDCODEMP = I.BDCODEMP AND P.BDCHAVE = I.BDCHAVE AND
P.BDORDEM = I.BDORDEM)
JOIN TCADPRO_VINC V ON (V.BDCODPROD = P.BDCODPROD AND V.BDCODEMP = P.BDCODEMP)
JOIN TNCM N ON (N.BDNCMPROD = V.BDNCMPROD)



--4
SELECT SAI.BDCODEMP, PROD.BDCODPROD, SAI.BDCHAVE, PROD.BDBCICMS, PROD.BDALIQICMS, PROD.BDVLRICMS, SAI.BDCODTER, SAI.BDREFLAN
    FROM (
        SELECT SAI.*
        FROM VEF_EMP_TMOVSAI SAI
        WHERE SAI.BDCODEMP = 67 AND SAI.BDREFLAN = 202101
         ) SAI
JOIN VEF_EMP_TMOVSAIITENS ITENS ON
(ITENS.BDCODEMP = SAI.BDCODEMP AND ITENS.BDCHAVE = SAI.BDCHAVE)
LEFT OUTER JOIN VEF_EMP_TMOVPROSAI PROD ON
(PROD.BDCODEMP = ITENS.BDCODEMP AND PROD.BDCHAVE = ITENS.BDCHAVE AND PROD.BDORDEM = ITENS.BDORDEM)
WHERE BDCODPROD IS NULL



--5
SELECT P.BDCODEMP, SUB.BDCHAVE, SUB.BDNUMDOCINI
FROM (
     SELECT *
     FROM VEF_EMP_TMOVENT M
     WHERE M.BDCODEMP = 67
     AND M.BDREFLAN = 202101
     ) SUB
LEFT OUTER JOIN VEF_EMP_TMOVENTITENS I ON (I.BDCODEMP = SUB.BDCODEMP AND I.BDCHAVE = SUB.BDCHAVE)
LEFT OUTER JOIN VEF_EMP_TMOVPROENT P ON (P.BDCODEMP = SUB.BDCODEMP AND P.BDCHAVE = I.BDCHAVE AND P.BDORDEM = I.BDORDEM)
JOIN TCADPRO_VINC V ON (V.BDCODPROD = P.BDCODPROD AND V.BDCODEMP = P.BDCODEMP)
LEFT OUTER JOIN TNCM N ON (N.BDNCMPROD = V.BDCODPROD)